{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Match React generation flow to final HTML (style select, inline status, download PNG)",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Align Art Style dropdown id and option values/labels with the provided final HTML.",
      "acceptanceCriteria": [
        "The style select element in the React UI has id=\"styleSelect\".",
        "Selecting each option results in the style value sent to the generation request being exactly one of: \"3D Pixar\", \"Cyberpunk Neon\", \"Pencil Sketch\", \"Renaissance Oil\".",
        "The visible option labels match exactly: \"3D Pixar Mode\", \"Cyberpunk Neon\", \"Pencil Sketch\", \"Oil Painting\"."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/ArtStyleSelect.tsx",
          "operation": "modify",
          "description": "Update the <select> options so option values remain exactly \"3D Pixar\", \"Cyberpunk Neon\", \"Pencil Sketch\", \"Renaissance Oil\" while the visible labels match the final HTML (\"3D Pixar Mode\", \"Cyberpunk Neon\", \"Pencil Sketch\", \"Oil Painting\"); keep id=\"styleSelect\" unchanged."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "On generate start, show the exact processing status text, clear any previous output image, and hide the Download button until success.",
      "acceptanceCriteria": [
        "On generate start, the UI shows \"Processing... (Please wait ~20s)\" exactly (English) in the status area.",
        "On generate start, any previously shown generated image preview is cleared.",
        "On generate start, the Download button is not visible."
      ],
      "file_operations": [
        {
          "path": "frontend/src/features/generation/useCaricatureGeneration.ts",
          "operation": "modify",
          "description": "Adjust the generate() return value to include the generated image URL and a timestamp on success (while preserving the multipart/form-data POST with fields named exactly \"image\" and \"style\"), so the UI can clear/show preview and drive timestamp-based downloads."
        },
        {
          "path": "frontend/src/screens/UploadPhotoScreen.tsx",
          "operation": "modify",
          "description": "Update generation start behavior to: set inline status text to exactly \"Processing... (Please wait ~20s)\", clear any previously displayed generated image preview state, and ensure the \"Download PNG\" button is hidden/disabled until generation succeeds."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "On successful generation, show \"Success!\" and reveal a Download PNG button that downloads with a timestamp-based filename.",
      "acceptanceCriteria": [
        "After a successful generation, the UI shows \"Success!\" exactly (English) in the status area.",
        "After a successful generation, a \"Download PNG\" button becomes visible.",
        "Clicking \"Download PNG\" downloads a PNG file named like \"caricature_<timestamp>.png\" (timestamp-based)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/screens/UploadPhotoScreen.tsx",
          "operation": "modify",
          "description": "After generate() success, set inline status text to exactly \"Success!\", render the generated output image preview, and show a \"Download PNG\" button that uses the existing download helper to download the generated image with filename format \"caricature_<timestamp>.png\" based on a timestamp (e.g., Date.now())."
        },
        {
          "path": "frontend/src/screens/ResultScreen.tsx",
          "operation": "modify",
          "description": "Align the download filename generation to be timestamp-based at click time (e.g., using Date.now()) and ensure the visible button label remains exactly \"Download PNG\" where applicable."
        }
      ]
    },
    {
      "id": "REQ-4",
      "summary": "On generation failure, show an inline \"Error: ...\" status message and keep Download hidden.",
      "acceptanceCriteria": [
        "If the caricature API request fails, the status area displays text that starts with \"Error: \" followed by an error message.",
        "After a failed generation attempt, the Download button is not visible."
      ],
      "file_operations": [
        {
          "path": "frontend/src/screens/UploadPhotoScreen.tsx",
          "operation": "modify",
          "description": "Replace toast-only failure handling with inline status text that starts with exactly \"Error: \" followed by the returned error message, and ensure the Download button remains hidden when generation fails."
        },
        {
          "path": "frontend/src/features/generation/useCaricatureGeneration.ts",
          "operation": "modify",
          "description": "Ensure generate() surfaces a clear error string (used by the UI for the \"Error: <message>\" status) while keeping the request format as multipart/form-data with fields named exactly \"image\" and \"style\"."
        }
      ]
    }
  ]
}